<<<<<<< HEAD
# haiguang-double-blocking-QR
=======
# 海光平台实现 Double Blocking QR 分解

## 编译
执行以下命令编译程序：
```bash
make
```

## 执行
运行程序时使用以下命令：
```bash
./mydoubleblocking_Iter_V6 m n nb b
```

### 参数说明
- `nb` 必须大于 `b`：`nb > b`
- 建议设置：`b = 32`

### 实验数据
- cuSOLVER只需要m和n，double blocking算法需要额外的nb和b，所以相同m，n执行时，cuSOLVER数据不变

#### 不生成Q的情况
- double blocking算法默认生成W，Y，R矩阵，其中W和Y矩阵可以用来生成Q
- 对于cuSolver，执行cusolverDnSgeqrf函数只生成Householder向量，而不显式生成
- 下面表格数据为不显式生成Q的性能对比
  
| `m`     | `n`     | `nb`   | `b`   | Double Blocking Time(s) | Double Blocking TFLOPS | cuSolver Time(s) | cuSolver TFLOPS |  
|---------|---------|--------|-------|--------------------------|------------------------|------------------|----------------|  
| 2048    | 2048    | 128    | 32    | 0.0855                   | 0.1340                 | 0.0882           | 0.1299         |  
| 4096    | 2048    | 128    | 32    | 0.1155                   | 0.2480                 | 0.1066           | 0.2686         |  
| 4096    | 4096    | 128    | 32    | 0.2078                   | 0.4410                 | 0.2265           | 0.4044         |  
| 8192    | 1024    | 128    | 32    | 0.0625                   | 0.2633                 | 0.0667           | 0.2470         |  
| 8192    | 2048    | 128    | 32    | 0.1269                   | 0.4962                 | 0.1446           | 0.4355         |  
| 8192    | 4096    | 128    | 32    | 0.2681                   | 0.8543                 | 0.3244           | 0.7061         |  
| 8192    | 8192    | 128    | 32    | 0.5420                   | 1.3524                 | 0.7516           | 0.9753         |  
| 8192    | 8192    | 1024   | 32    | 0.5216                   | 1.4054                 | 0.7516           | 0.9753         |  
| 8192    | 8192    | 2048   | 32    | 0.5363                   | 1.3669                 | 0.7516           | 0.9753         |  
| 16384   | 8192    | 128    | 32    | 0.7990                   | 2.2934                 | 1.4249           | 1.2861         |  
| 16384   | 8192    | 1024   | 32    | 0.7457                   | 2.4574                 | 1.4249           | 1.2861         |  
| 16384   | 128     | 64     | 32    | 0.0101                   | 0.0533                 | 0.0110           | 0.0488         |  
| 16384   | 256     | 64     | 32    | 0.0179                   | 0.1190                 | 0.0249           | 0.0857         |  
| 16384   | 512     | 64     | 32    | 0.0349                   | 0.2435                 | 0.0531           | 0.2983         |  
| 16384   | 1024    | 64     | 32    | 0.0696                   | 0.4836                 | 0.1128           | 0.2983         |  
| 16384   | 16384   | 128    | 32    | 1.9083                   | 3.0730                 | 1.4249           | 1.2861         |  
| 16384   | 16384   | 1024   | 32    | 1.6347                   | 3.5872                 | 3.7777           | 1.5523         |  
| 16384   | 16384   | 2048   | 32    | 1.6922                   | 3.4654                 | 3.7777           | 1.5523         |  


#### 生成Q的情况
- double blocking算法通过额外执行gemm生成Q矩阵
- cuSolver通过额外执行cusolverDnSorgqr函数生成Q矩阵
- 下面表格数据为显式生成Q的性能对比
  
| `m`     | `n`     | `nb`   | `b`   | Double Blocking Time(s) | Double Blocking TFLOPS | cuSolver Time(s) | cuSolver TFLOPS |  
|---------|---------|--------|-------|--------------------------|------------------------|------------------|----------------|  
| 128     | 128     | 64     | 32    | 0.0057                   | 0.0005                 | 0.0049           | 0.0006         |  
| 256     | 256     | 64     | 32    | 0.0103                   | 0.0022                 | 0.0137           | 0.0016         |  
| 512     | 512     | 128    | 32    | 0.0192                   | 0.0093                 | 0.0322           | 0.0056         |  
| 1024    | 1024    | 128    | 32    | 0.0403                   | 0.0355                 | 0.0721           | 0.0198         |  
| 2048    | 2048    | 128    | 32    | 0.0878                   | 0.1305                 | 0.1694           | 0.0676         |  
| 4096    | 2048    | 128    | 32    | 0.1250                   | 0.2290                 | 0.2077           | 0.1378         |  
| 4096    | 4096    | 128    | 32    | 0.2220                   | 0.4127                 | 0.4432           | 0.2067         |  
| 8192    | 1024    | 128    | 32    | 0.0822                   | 0.2003                 | 0.1345           | 0.1224         |  
| 8192    | 2048    | 128    | 32    | 0.1557                   | 0.4047                 | 0.2919           | 0.2158         |  
| 8192    | 4096    | 128    | 32    | 0.3283                   | 0.6977                 | 0.6529           | 0.3508         |  
| 8192    | 8192    | 128    | 32    | 0.6519                   | 1.1245                 | 1.5025           | 0.4879         |  
| 8192    | 8192    | 1024   | 32    | 0.6411                   | 1.1433                 | 1.5025           | 0.4879         |  
| 8192    | 8192    | 2048   | 32    | 0.6454                   | 1.1357                 | 1.5025           | 0.4879         |  
| 16384   | 256     | 64     | 32    | 0.0377                   | 0.0566                 | 0.0488           | 0.0438         |  
| 16384   | 512     | 64     | 32    | 0.0705                   | 0.1205                 | 0.1049           | 0.0810         |  
| 16384   | 1024    | 64     | 32    | 0.1300                   | 0.2589                 | 0.2243           | 0.1500         |  
| 16384   | 8192    | 128    | 32    | 1.3191                   | 1.3892                 | 2.8832           | 0.6356         |  
| 16384   | 8192    | 1024   | 32    | 1.2643                   | 1.4494                 | 2.8832           | 0.6356         |  
| 16384   | 16384   | 128    | 32    | 3.0871                   | 1.8995                 | 7.5833           | 0.7733         |  
| 16384   | 16384   | 1024   | 32    | 2.8081                   | 2.0883                 | 7.5833           | 0.7733         |  
| 16384   | 16384   | 2048   | 32    | 2.8277                   | 2.0738                 | 7.5833           | 0.7733         |  
  
>>>>>>> e5fadc6617c65516b6c82b8410af30fd1a7661e2
